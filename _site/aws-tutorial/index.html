<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>AWS Tutorial</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Supplemental notes to Stanford's CS229">
    <link rel="canonical" href="http://machine-learning-basics.github.io/aws-tutorial/">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">

    <!-- Google fonts -->
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300' rel='stylesheet' type='text/css'>

    <!-- Google tracking -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-46895817-2', 'auto');
      ga('send', 'pageview');

    </script>
    
</head>


    <body>

    <header class="site-header">

  <div class="wrap title-wrap">
    <a class="site-title" href="/">Machine Learning Basics</a>
  </div>

</header>


    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>AWS Tutorial</h1>
  </header>

  <article class="post-content">
  <p>For GPU instances, we also have an Amazon Machine Image (AMI) that you can use
to launch GPU instances on Amazon EC2. This tutorial goes through how to set up
your own EC2 instance with the provided AMI. <strong>We do not currently 
distribute AWS credits to CS231N students but you are welcome to use this 
snapshot on your own budget.</strong></p>

<p><strong>TL;DR</strong> for the AWS-savvy: Our image is
<code class="highlighter-rouge">cs231n_caffe_torch7_keras_lasagne_v2</code>, AMI ID: <code class="highlighter-rouge">ami-125b2c72</code> in the us-west-1
region. Use a <code class="highlighter-rouge">g2.2xlarge</code> instance.  Caffe, Torch7, Theano, Keras and Lasagne
are pre-installed. Python bindings of caffe are available. It has CUDA 7.5 and
CuDNN v3.</p>

<p>First, if you don’t have an AWS account already, create one by going to the <a href="http://aws.amazon.com/">AWS
homepage</a>, and clicking on the yellow “Sign In to the
Console” button. It will direct you to a signup page which looks like the
following.</p>

<div class="fig figcenter fighighlight">
  <img src="/assets/aws-signup.png" />
</div>

<p>Select the “I am a new user” checkbox, click the “Sign in using our secure
server” button, and follow the subsequent pages to provide the required details.
They will ask for a credit card information, and also a phone verification, so
have your phone and credit card ready.</p>

<p>Once you have signed up, go back to the <a href="http://aws.amazon.com">AWS homepage</a>,
click on “Sign In to the Console”, and this time sign in using your username and
password.</p>

<div class="fig figcenter fighighlight">
  <img src="/assets/aws-signin.png" />
</div>

<p>Once you have signed in, you will be greeted by a page like this:</p>

<div class="fig figcenter fighighlight">
  <img src="/assets/aws-homepage.png" />
</div>

<p>Make sure that the region information on the top right is set to N. California.
If it is not, change it to N. California by selecting from the dropdown menu
there.</p>

<p>(Note that the subsequent steps requires your account to be “Verified” by
 Amazon. This may take up to 2 hrs, and you may not be able to launch instances
 until your account verification is complete.)</p>

<p>Next, click on the EC2 link (first link under the Compute category). You will go
to a dashboard page like this:</p>

<div class="fig figcenter fighighlight">
  <img src="/assets/ec2-dashboard.png" />
</div>

<p>Click the blue “Launch Instance” button, and you will be redirected to a page
like the following:</p>

<div class="fig figcenter fighighlight">
  <img src="/assets/ami-selection.png" />
</div>

<p>Click on the “Community AMIs” link on the left sidebar, and search for “cs231n”
in the search box. You should be able to see the AMI
<code class="highlighter-rouge">cs231n_caffe_torch7_keras_lasagne_v2</code> (AMI ID: <code class="highlighter-rouge">ami-125b2c72</code>). Select that
AMI, and continue to the next step to choose your instance type.</p>

<div class="fig figcenter fighighlight">
  <img src="/assets/community-AMIs.png" />
</div>

<p>Choose the instance type <code class="highlighter-rouge">g2.2xlarge</code>, and click on “Review and Launch”.</p>

<div class="fig figcenter fighighlight">
  <img src="/assets/instance-selection.png" />
</div>

<p>In the next page, click on Launch.</p>

<div class="fig figcenter fighighlight">
  <img src="/assets/launch-screen.png" />
</div>

<p>You will be then prompted to create or use an existing key-pair. If you already
use AWS and have a key-pair, you can use that, or alternately you can create a
new one by choosing “Create a new key pair” from the drop-down menu and giving
it some name of your choice. You should then download the key pair, and keep it
somewhere that you won’t accidentally delete. Remember that there is <strong>NO WAY</strong>
to get to your instance if you lose your key.</p>

<div class="fig figcenter fighighlight">
  <img src="/assets/key-pair.png" />
</div>

<div class="fig figcenter fighighlight">
  <img src="/assets/key-pair-create.png" />
</div>

<p>Once you download your key, you should change the permissions of the key to
user-only RW, In Linux/OSX you can do it by:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ chmod 600 PEM_FILENAME
</code></pre>
</div>
<p>Here <code class="highlighter-rouge">PEM_FILENAME</code> is the full file name of the .pem file you just downloaded.</p>

<p>After this is done, click on “Launch Instances”, and you should see a screen
showing that your instances are launching:</p>

<div class="fig figcenter fighighlight">
  <img src="/assets/launching-screen.png" />
</div>

<p>Click on “View Instances” to see your instance state. It should change to
“Running” and “2/2 status checks passed” as shown below within some time. You
are now ready to ssh into the instance.</p>

<div class="fig figcenter fighighlight">
  <img src="/assets/instances-page.png" />
</div>

<p>First, note down the Public IP of the instance from the instance listing. Then,
do:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ssh -i PEM_FILENAME ubuntu@PUBLIC_IP
</code></pre>
</div>

<p>Now you should be logged in to the instance. You can check that Caffe is working
by doing:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cd caffe
$ ./build/tools/caffe time --gpu 0 --model examples/mnist/lenet.prototxt
</code></pre>
</div>

<p>We have Caffe, Theano, Torch7, Keras and Lasagne pre-installed. Caffe python
bindings are also available by default. We have CUDA 7.5 and CuDNN v3 installed.</p>

<p>If you encounter any error such as</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Check failed: error == cudaSuccess (77 vs.  0)  an illegal memory access was encountered
</code></pre>
</div>

<p>you might want to terminate your instance and start over again. I have observed
this rarely, and I am not sure what causes this.</p>

<p>About how to use these instances:</p>

<ul>
  <li>The root directory is only 12GB, and only ~ 3GB of that is free.</li>
  <li>There should be a 60GB <code class="highlighter-rouge">/mnt</code> directory that you can use to put your data,
model checkpoints, models etc.</li>
  <li>Remember that the <code class="highlighter-rouge">/mnt</code> directory won’t be persistent across
reboots/terminations.</li>
  <li>Stop your instances when are done for the day to avoid incurring charges. GPU
instances are costly. Use your funds wisely. Terminate them when you are sure
you are done with your instance (disk storage also costs something, and can be
significant if you have a large disk footprint).</li>
  <li>Look into creating custom alarms to automatically stop your instances when
they are not doing anything.</li>
  <li>If you need access to a large dataset and don’t want to download it every time
you spin up an instance, the best way to go would be to create an AMI for that
and attach that AMI to your machine when configuring your instance (before
launching but after you have selected the AMI).</li>
</ul>

  </article>

</div>
      </div>
    </div>

    <footer class="site-footer">

  <div class="wrap">

    <div class="footer-col-1 column">
      <ul>
        
        <li>
          <a href="https://github.com/carsontang">
            <span class="icon github">
              <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>
            <span class="username">carsontang</span>
          </a>
        </li>
        
        <li>
          <a href="mailto:machine.learning.basics@gmail.com">machine.learning.basics@gmail.com</a>
        </li>
      </ul>
    </div>

    <div class="footer-col-2 column">
        
    </div>

    <div class="footer-col-3 column">
      
    </div>

  </div>

</footer>


    <!-- mathjax -->
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </body>
</html>